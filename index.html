<!DOCTYPE html>
<html lang="en">
    <head>
        <title>CITA Counties Map</title>
        <meta charset="utf-8" name="viewport" content="width=device-width, initial-scale=1.0">
        <!-- Bootstrap -->
        <link href="css/bootstrap.min.css" rel="stylesheet">
    
        <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
        <!--[if lt IE 9]>
          <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
          <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
        <link type="text/css" href="css/cita.css" rel="stylesheet">
        <script type="text/javascript" src="http://d3js.org/d3.v3.min.js"></script>
        <script type="text/javascript" src="http://d3js.org/topojson.v1.min.js"></script>
        <script type="text/javascript" src="https://code.jquery.com/jquery.js"></script>
        <script type="text/javascript" src="js/bootstrap.min.js"></script>
        <script type="text/javascript" src="js/tabletop.js"></script>
    </head>
    <body>
<!--       <div class="container"> -->
        <div class="row">
          <div id="map" class="col-sm-8"></div>
          <div class="col-sm-4 info-panel"><h3 id="county">County Details</h3>
            <p id="population">Click on a County to see details.</p>
            <p id="children-in-care"></p>
            <p id="rate-per-1000"></p>
          </div>
        </div>
<!--       </div> -->
      <script type="text/javascript">
        var width = 610,
            height = 400;

        var path = d3.geo.path()
                         .projection(null);
        
        var svg = d3.select("#map").append("svg")
                    .attr("width", width)
                    .attr("height", height);
        
        d3.json("data/wa-noproj-600.json", function(error, wa) {
          
          svg.selectAll("path")
             .data(topojson.feature(wa, wa.objects.counties).features)
             .enter().append("path")
             .attr("d", path)
             .on("click", function(d,i) {
               d3.select("#county")
                 .text(d.properties.NAME + " County");
               for (var j = 0; j < gData.length; j++) {
                 if (d.properties.NAME == gData[j].county) {
                   d3.select("#population")
                     .text("Population: " + gData[j].totalpopulation);
                   d3.select("#children-in-care")
                     .text("Children In Care: " + gData[j].childrenincare);
                   d3.select("#rate-per-1000")
                     .text("Rate per 1000 People: " + Math.round(parseFloat(gData[j].rateper1000people) * 100) / 100);
                   break;
                 } else {
                   d3.select("#population")
                     .text("Population: not available");
                   d3.select("#children-in-care")
                     .text("Children In Care: not available");
                   d3.select("#rate-per-1000")
                     .text("Rate per 1000 People: not available");
                 };
               };
             });

          svg.selectAll(".county-label")
             .data(topojson.feature(wa, wa.objects.counties).features)
             .enter().append("text")
             .attr("class", function(d) { return "county-label"; })
             .attr("transform", function(d) { return "translate(" + path.centroid(d) + ")"; })
             .attr("dy", ".35em")
             .text(function(d) { return d.properties.NAME; });
          
          $(document).ready(function() {
            var gData;
            var URL = "0AmpYqzYhzPB3dEtOLUFmYTdqbEVBMi1GRkdqRU5BdWc";
            Tabletop.init( { key: URL, callback: panelDetails, simpleSheet: true } ) 
          });
          
          function panelDetails(data) {
            gData = data;
          }
        });
      </script>
    </body>
</html>